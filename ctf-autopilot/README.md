# CTF Autopilot Analyzer

A production-grade, security-first, local-only CTF challenge analyzer and writeup generator. This tool ingests challenge descriptions and attached files, runs deterministic offline analysis in an isolated Docker sandbox, extracts evidence and candidate flags, and generates professional writeups.

## âš¡ Quick Start (Ubuntu 24.04 LTS)

```bash
# One-command install and run
curl -fsSL https://raw.githubusercontent.com/your-org/ctf-autopilot/main/infra/scripts/install_ubuntu_24.04.sh | bash
```

Or manually:

```bash
# Clone the repository
git clone https://github.com/your-org/ctf-autopilot.git
cd ctf-autopilot

# Copy environment file and configure
cp .env.example .env
# Edit .env and add your MEGALLM_API_KEY

# Run with Docker Compose
./infra/scripts/prod_up.sh
```

Access the application at `http://localhost:3000`

## ğŸ” Security First

This tool is designed for **offline, local-only analysis**. It does NOT:
- Connect to remote challenge servers
- Perform automatic exploitation
- Execute arbitrary network requests from sandboxes

All analysis runs in isolated Docker containers with:
- Network disabled (`--network=none`)
- Read-only filesystems where possible
- CPU/memory/time limits
- Non-root user execution
- Seccomp/AppArmor profiles

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Next.js)                    â”‚
â”‚                    localhost:3000                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx Reverse Proxy                       â”‚
â”‚                    (TLS Termination)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Backend                           â”‚
â”‚                    localhost:8000                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Auth       â”‚  â”‚  Jobs       â”‚  â”‚  Writeup    â”‚          â”‚
â”‚  â”‚  Service    â”‚  â”‚  Service    â”‚  â”‚  Generator  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Celery Workers                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Analysis   â”‚  â”‚  Sandbox    â”‚  â”‚  Evidence   â”‚          â”‚
â”‚  â”‚  Tasks      â”‚  â”‚  Runner     â”‚  â”‚  Extractor  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Docker API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Sandbox Container (--network=none)              â”‚
â”‚  Tools: strings, file, binwalk, exiftool, readelf, etc.     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Repository Structure

```
ctf-autopilot/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                 # Next.js frontend
â”‚   â””â”€â”€ api/                 # FastAPI backend
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/              # Shared types/schemas
â”œâ”€â”€ sandbox/
â”‚   â”œâ”€â”€ image/               # Sandbox Dockerfile
â”‚   â”œâ”€â”€ profiles/            # Seccomp/AppArmor profiles
â”‚   â””â”€â”€ playbooks/           # Analysis playbooks per file type
â”œâ”€â”€ infra/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ nginx/               # Reverse proxy config
â”‚   â””â”€â”€ scripts/             # Install and run scripts
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â”œâ”€â”€ SECURITY.md
â”‚   â”œâ”€â”€ THREAT_MODEL.md
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ RUNBOOK.md
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ci.yml
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ LICENSE
â””â”€â”€ README.md
```

## ğŸ”§ Configuration

### Environment Variables

| Variable | Description | Required |
|----------|-------------|----------|
| `MEGALLM_API_KEY` | API key for MegaLLM writeup generation | Yes |
| `ADMIN_PASSWORD` | Password for local admin login | Yes |
| `SECRET_KEY` | JWT signing key (auto-generated if not set) | No |
| `MAX_UPLOAD_SIZE_MB` | Maximum upload size (default: 200) | No |
| `SANDBOX_TIMEOUT_SECONDS` | Per-command timeout (default: 60) | No |
| `POSTGRES_PASSWORD` | Database password | Yes |
| `REDIS_PASSWORD` | Redis password | No |

### TLS Configuration

#### Development (Self-Signed)
```bash
./infra/scripts/generate_self_signed_cert.sh
docker compose -f docker-compose.yml -f docker-compose.tls.yml up -d
```

#### Production (Let's Encrypt)
See [docs/RUNBOOK.md](docs/RUNBOOK.md#tls-configuration) for Let's Encrypt setup.

## ğŸ› ï¸ Development

```bash
# Start development environment
./infra/scripts/dev_up.sh

# Run backend tests
cd apps/api && pytest

# Run frontend tests
cd apps/web && npm test

# Run linting
cd apps/api && ruff check .
cd apps/web && npm run lint
```

## ğŸ“– Documentation

- [Architecture](docs/ARCHITECTURE.md) - System design and component overview
- [Security](docs/SECURITY.md) - Security controls and best practices
- [Threat Model](docs/THREAT_MODEL.md) - Security threat analysis
- [API Reference](docs/API.md) - REST API documentation
- [Runbook](docs/RUNBOOK.md) - Operations and troubleshooting guide

## ğŸ“„ License

MIT License - See [LICENSE](LICENSE) for details.

## âš ï¸ Disclaimer

This tool is intended for:
- Post-competition CTF writeup generation
- Offline analysis of challenge files you have permission to analyze
- Educational and learning purposes

**DO NOT** use this tool to:
- Attack systems without authorization
- Analyze files you don't have permission to access
- Circumvent security controls
